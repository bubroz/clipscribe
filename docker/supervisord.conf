[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor/

[program:clipscribe-api]
command=/opt/venv/bin/uvicorn clipscribe.api.app:app --host 0.0.0.0 --port 8000 --workers 4 --loop uvloop --http httptools
directory=/app
user=clipscribe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/clipscribe/api.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
environment=PYTHONPATH=/app/src,PYTHONUNBUFFERED=1,REDIS_URL=redis://redis:6379

[program:clipscribe-worker]
command=/opt/venv/bin/python -m rq worker --url redis://redis:6379 clipscribe-queue
directory=/app
user=clipscribe
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/clipscribe/worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
environment=PYTHONPATH=/app/src,PYTHONUNBUFFERED=1

[group:clipscribe-services]
programs=clipscribe-api,clipscribe-worker
priority=999
