---
description: Best practices for implementing knowledge extractors
globs: 
alwaysApply: false
---
---
description: "Best practices for implementing knowledge extractors"
globs: ["src/clipscribe/extractors/**/*.py"]
alwaysApply: false
---

# Knowledge Extractor Patterns

## Extractor Types

ClipScribe supports multiple extraction strategies:

1. **SpaCy Extractor**: For general NER and entity extraction
2. **GLiNER Extractor**: For advanced entity recognition
3. **REBEL Extractor**: For relationship extraction
4. **Hybrid Extractor**: Combines multiple approaches
5. **Advanced Hybrid**: Includes video intelligence features

## Common Interface

All extractors must implement the base interface:

```python
class BaseExtractor:
    def extract(self, text: str) -> Dict[str, Any]:
        """Extract knowledge from text.
        
        Returns:
            Dict containing:
            - entities: List of extracted entities
            - relationships: List of entity relationships
            - metadata: Additional extraction metadata
        """
        raise NotImplementedError
```

## Entity Format

Standardized entity structure:

```python
{
    "text": "Apple Inc.",
    "label": "ORGANIZATION",
    "start": 10,
    "end": 20,
    "confidence": 0.95,
    "metadata": {
        "source": "spacy",
        "model_version": "en_core_web_sm"
    }
}
```

## Relationship Format

```python
{
    "subject": "Steve Jobs",
    "predicate": "founded",
    "object": "Apple Inc.",
    "confidence": 0.87,
    "metadata": {
        "extractor": "rebel",
        "context": "surrounding text..."
    }
}
```

## Best Practices

### Performance Optimization
- Batch process when possible
- Cache model loading
- Use appropriate model sizes based on requirements
- Implement streaming for large texts

### Error Handling
```python
def extract(self, text: str) -> Dict[str, Any]:
    try:
        # Validate input
        if not text or len(text.strip()) == 0:
            return {"entities": [], "relationships": [], "metadata": {}}
        
        # Process text
        results = self._process(text)
        
        # Validate output
        return self._validate_results(results)
    except Exception as e:
        logger.error(f"Extraction failed: {e}")
        return {"entities": [], "relationships": [], "error": str(e)}
```

### Configuration
- Make extractors configurable via settings
- Support different confidence thresholds
- Allow enabling/disabling of specific features
- Provide sensible defaults

## Testing Extractors

```python
def test_extractor():
    extractor = YourExtractor()
    text = "Apple Inc. was founded by Steve Jobs in Cupertino."
    
    results = extractor.extract(text)
    
    assert len(results["entities"]) >= 3
    assert any(e["text"] == "Apple Inc." for e in results["entities"])
    assert any(r["predicate"] == "founded" for r in results["relationships"])
```

## Integration Tips

- Design extractors to be composable
- Support both synchronous and asynchronous operations
- Provide progress callbacks for long-running extractions
- Include extraction metadata for debugging
